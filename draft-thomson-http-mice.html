<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Merkle Integrity Content Encoding</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre {
  font: 15px Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 The &#8220;mi-sha256&#8221; HTTP Content Encoding">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Content Encoding Structure">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Validating Integrity Proofs">
<link href="#rfc.section.3" rel="Chapter" title="3 The MI HTTP Header Field">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 MI Header Field Parameters">
<link href="#rfc.section.4" rel="Chapter" title="4 Examples">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Simple Example">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Example with Multiple Records">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Message Truncation">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Algorithm Agility">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 The &#8220;mi-sha256&#8221; HTTP Content Encoding">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 MI Header Field">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 The HTTP MI Parameter Registry">
<link href="#rfc.section.6.3.1" rel="Chapter" title="6.3.1 mi-sha256 parameter">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.appendix.B" rel="Chapter" title="B FAQ">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.8 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-thomson-http-mice-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-06-25" />
  <meta name="dct.abstract" content="This memo introduces a content-coding for HTTP that provides progressive integrity for message contents.  This integrity protection can be evaluated on a partial representation, allowing a recipient to process a message as it is delivered while retaining strong integrity protection." />
  <meta name="description" content="This memo introduces a content-coding for HTTP that provides progressive integrity for message contents.  This integrity protection can be evaluated on a partial representation, allowing a recipient to process a message as it is delivered while retaining strong integrity protection." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Thomson</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Mozilla</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">June 25, 2018</td>
</tr>
<tr>
<td class="left">Expires: December 27, 2018</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Merkle Integrity Content Encoding<br />
  <span class="filename">draft-thomson-http-mice-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This memo introduces a content-coding for HTTP that provides progressive integrity for message contents.  This integrity protection can be evaluated on a partial representation, allowing a recipient to process a message as it is delivered while retaining strong integrity protection.</p>
<h1><a>Note to Readers</a></h1>
<p><em>RFC EDITOR: please remove this section before publication</em></p>
<p>Discussion of this draft takes place on the HTTP working group mailing list (ietf-http-wg@w3.org), which is archived at <a href="https://lists.w3.org/Archives/Public/ietf-http-wg/">https://lists.w3.org/Archives/Public/ietf-http-wg/</a>.</p>
<p>The source code and issues list for this draft can be found at <a href="https://github.com/martinthomson/http-mice">https://github.com/martinthomson/http-mice</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 27, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">The &#8220;mi-sha256&#8221; HTTP Content Encoding</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Content Encoding Structure</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Validating Integrity Proofs</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">The MI HTTP Header Field</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">MI Header Field Parameters</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Examples</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Simple Example</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Example with Multiple Records</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Message Truncation</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Algorithm Agility</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">The &#8220;mi-sha256&#8221; HTTP Content Encoding</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">MI Header Field</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">The HTTP MI Parameter Registry</a>
</li>
<ul><li>6.3.1.   <a href="#rfc.section.6.3.1">mi-sha256 parameter</a>
</li>
</ul></ul><li>7.   <a href="#rfc.references">References</a>
</li>
<ul><li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">FAQ</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Integrity protection for HTTP content is highly valuable.  HTTPS <a href="#RFC2818" class="xref">[RFC2818]</a> is the most common form of integrity protection deployed, but that requires a direct TLS <a href="#RFC5246" class="xref">[RFC5246]</a> connection to a host.  However, additional integrity protection might be desirable for some use cases.  This might be for additional protection against failures or attack (see <a href="#SRI" class="xref">[SRI]</a>) or because content needs to remain unmodified throughout multiple HTTPS-protected exchanges.</p>
<p id="rfc.section.1.p.2">This document describes a &#8220;mi-sha256&#8221; content-encoding (see <a href="#encoding" class="xref">Section 2</a>) that is a progressive, hash-based integrity check based on Merkle Hash Trees <a href="#MERKLE" class="xref">[MERKLE]</a>.</p>
<p id="rfc.section.1.p.3">The means of conveying the root integrity proof used by this content encoding will depend on deployment requirements.  This document defines an MI header field (see <a href="#header" class="xref">Section 3</a>) that can carry an integrity proof.</p>
<h2 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a>
</h2>
<p id="rfc.section.1.1.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#encoding" id="encoding">The &#8220;mi-sha256&#8221; HTTP Content Encoding</a>
</h1>
<p id="rfc.section.2.p.1">A Merkle Hash Tree <a href="#MERKLE" class="xref">[MERKLE]</a> is a structured integrity mechanism that collates multiple integrity checks into a tree.  The leaf nodes of the tree contain data (or hashes of data) and non-leaf nodes contain hashes of the nodes below them.</p>
<p id="rfc.section.2.p.2">A balanced Merkle Hash Tree is used to efficiently prove membership in large sets (such as in <a href="#RFC6962" class="xref">[RFC6962]</a>).  However, in this case, a right-skewed tree is used to provide a progressive integrity proof.  This integrity proof is used to establish that a given record is part of a message.</p>
<p id="rfc.section.2.p.3">The hash function used for &#8220;mi-sha256&#8221; content encoding is SHA-256 <a href="#FIPS180-4" class="xref">[FIPS180-4]</a>.  The integrity proof for all records other than the last is the hash of the concatenation of the record, the integrity proof of all subsequent records, and a single octet with a value of 0x1:</p>
<pre>
   proof(r[i]) = SHA-256(r[i] || proof(r[i+1]) || 0x1)
</pre>
<p id="rfc.section.2.p.4">The integrity proof for the final record is the hash of the record with a single octet with a value 0x0 appended:</p>
<pre>
   proof(r[last]) = SHA-256(r[last] || 0x0)
</pre>
<p><a href="#ex-proofs" class="xref">Figure 1</a> shows the structure of the integrity proofs for a message that is split into 4 blocks: A, B, C, D).  As shown, the integrity proof for the entire message (that is, <samp>proof(A)</samp>) is derived from the content of the first block (A), plus the value of the proof for the second and subsequent blocks.</p>
<div id="rfc.figure.1"></div>
<div id="ex-proofs"></div>
<pre>
    proof(A)
      /\
     /  \
    /    \
   A    proof(B)
         /\
        /  \
       /    \
      B    proof(C)
             /\
            /  \
           /    \
          C    proof(D)
                 |
                 |
                 D
</pre>
<p class="figure">Figure 1: Proof structure for a message with 4 blocks</p>
<p id="rfc.section.2.p.6">The final encoded message is formed from the first record, followed by an arbitrary number of tuples of the integrity proof of the next record and then the record itself.  Thus, in <a href="#ex-proofs" class="xref">Figure 1</a>, the body is:</p>
<pre>
   rs || A || proof(B) || B || proof(C) || C || proof(D) || D
</pre>
<p></p>

<dl>
<dt>Note:</dt>
<dd style="margin-left: 8">The <samp>||</samp> operator is used to represent concatenation.</dd>
</dl>
<p id="rfc.section.2.p.8">A message that has a content length less than or equal to the content size does not include any inline proofs.  The proof for a message with a single record is simply the hash of the body plus a trailing zero octet.</p>
<h2 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#records" id="records">Content Encoding Structure</a>
</h2>
<p id="rfc.section.2.1.p.1">In order to produce the final content encoding the content of the message is split into equal-sized records.  The final record can contain less than the defined record size.</p>
<p id="rfc.section.2.1.p.2">The record size is included in the first 8 octets of the message as an unsigned 64-bit integer.  This refers to the length of each data block.</p>
<p id="rfc.section.2.1.p.3">The final encoded stream comprises of the record size (&#8220;rs&#8221;), plus a sequence of records, each &#8220;rs&#8221; octets in length.  Each record, other than the last, is followed by a 32 octet proof for the record that follows.  This allows a receiver to validate and act upon each record after receiving the proof that precedes it.  The final record is not followed by a proof.</p>
<p></p>

<dl>
<dt>Note:</dt>
<dd style="margin-left: 8">This content encoding increases the size of a message by 8 plus 32 octets times the length of the message divided by the record size, rounded up, less one.  That is, 8 + 32 * (ceil(length / rs) - 1).</dd>
</dl>
<p id="rfc.section.2.1.p.5">Constructing a message with the &#8220;mi-sha256&#8221; content encoding requires processing of the records in reverse order, inserting the proof derived from each record before that record.</p>
<p id="rfc.section.2.1.p.6">This structure permits the use of range requests <a href="#RFC7233" class="xref">[RFC7233]</a>. However, to validate a given record, a contiguous sequence of records back to the start of the message is needed.</p>
<h2 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#validating-integrity-proofs" id="validating-integrity-proofs">Validating Integrity Proofs</a>
</h2>
<p id="rfc.section.2.2.p.1">A receiver of a message with the &#8220;mi-sha256&#8221; content-encoding applied first attempts to acquire the integrity proof for the first record.  If the MI header field is present, a value might be included there.</p>
<p id="rfc.section.2.2.p.2">The first 8 octets are read as an unsigned 64-bit integer, &#8220;rs&#8221;.  The remainder of the message is read into records of size &#8220;rs&#8221; (based on the value in the MI header field) plus 32 octets.  The last record is between 1 and &#8220;rs&#8221; octets in length, if not then validation fails.  For each record:</p>
<p></p>

<ol>
<li>Hash the record using SHA-256 with a single octet appended:  <br><br> a. All records other than the last have an octet with a value of 0x1 appended.  <br><br> b. The last record has an octet with a value of 0x0 appended.</li>
<li>Compare the hash with the expected value:  <br><br> a. For the first record, the expected value might found in the MI header field and is otherwise provided through some external means.  <br><br> b. For records after the first, the expected value is the last 32 octets of the previous record.</li>
<li>If the hash is different, then this record and all subsequent records do not have integrity protection and this process ends.</li>
<li>If a record is valid, up to &#8220;rs&#8221; octets is passed on for processing.  In other words, the trailing 32 octets is removed from every record other than the last before being used.</li>
</ol>
<p id="rfc.section.2.2.p.4">If an integrity check fails, the message SHOULD be discarded and the exchange treated as an error unless explicitly configured otherwise.  For clients, treat this as equivalent to a server error; servers SHOULD generate a 400 or other 4xx status code.  However, if the integrity proof for the first record is not known, this check SHOULD NOT fail unless explicitly configured to do so.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#header" id="header">The MI HTTP Header Field</a>
</h1>
<p id="rfc.section.3.p.1">The MI HTTP header field carries message integrity proofs corresponding to content encoding(s) that have been applied to a payload body.</p>
<p id="rfc.section.3.p.2">The MI header field uses the extended ABNF syntax defined in Section 1.2 of <a href="#RFC7230" class="xref">[RFC7230]</a> and the <samp>parameter</samp> rule from <a href="#RFC7231" class="xref">[RFC7231]</a>:</p>
<pre>
  MI = #mi_params
  mi_params = [ parameter *( ";" parameter ) ]
</pre>
<p id="rfc.section.3.p.3">If the payload is encoded more than once (as reflected by having multiple content-codings that use the message integrity header field), each application of the content encoding is reflected in the MI header field in the order in which they were applied.</p>
<p id="rfc.section.3.p.4">The MI header MAY be omitted if the sender intends for the receiver to acquire the integrity proof for the first record by other means.</p>
<h2 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#mi-header-field-parameters" id="mi-header-field-parameters">MI Header Field Parameters</a>
</h2>
<p id="rfc.section.3.1.p.1">The following parameters are used in validating content encoded with the &#8220;mi-sha256&#8221; content encoding:</p>
<p></p>

<dl>
<dt>mi-sha256:</dt>
<dd style="margin-left: 8">The &#8220;mi-sha256&#8221; parameter carries an integrity proof for the first record of the message.  This provides integrity for the entire message body.  This value is encoded using base64url encoding <a href="#RFC7515" class="xref">[RFC7515]</a>.</dd>
</dl>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<h2 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#simple-example" id="simple-example">Simple Example</a>
</h2>
<p id="rfc.section.4.1.p.1">The following example contains a short message.  This contains just a single record, so there are no inline integrity proofs, just a single value in a MI header field.  The record size is prepended to the message body (shown here in angle brackets).</p>
<pre>
HTTP/1.1 200 OK
MI: mi-sha256=dcRDgR2GM35DluAV13PzgnG6-pvQwPywfFvAu1UeFrs
Content-Encoding: mi-sha256
Content-Length: 49

&lt;0x0000000000000029&gt;When I grow up, I want to be a watermelon
</pre>
<h2 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#example-with-multiple-records" id="example-with-multiple-records">Example with Multiple Records</a>
</h2>
<p id="rfc.section.4.2.p.1">This example shows the same message as above, but with a smaller record size (16 octets).  This results in two integrity proofs being included in the representation.</p>
<pre>
PUT /test HTTP/1.1
Host: example.com
MI: mi-sha256=IVa9shfs0nyKEhHqtB3WVNANJ2Njm5KjQLjRtnbkYJ4
Content-Encoding: mi-sha256
Content-Length: 113

&lt;0x0000000000000010&gt;When I grow up,
OElbplJlPK-Rv6JNK6p5_515IaoPoZo-2elWL7OQ60A
I want to be a w
iPMpmgExHPrbEX3_RvwP4d16fWlK4l--p75PUu_KyN0
atermelon
</pre>
<p id="rfc.section.4.2.p.2">Since the inline integrity proofs contain non-printing characters, these are shown here using the base64url encoding <a href="#RFC7515" class="xref">[RFC7515]</a> with new lines between the original text and integrity proofs.  Note that there is a single trailing space (0x20) on the first line.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The integrity of an entire message body depends on the means by which the integrity proof for the first record is protected.  If this value comes from the same place as the message, then this provides only limited protection against transport-level errors (something that TLS provides adequate protection against).</p>
<p id="rfc.section.5.p.2">Separate protection for header fields might be provided by other means if the first record retrieved is the first record in the message, but range requests do not allow for this option.</p>
<h2 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#message-truncation" id="message-truncation">Message Truncation</a>
</h2>
<p id="rfc.section.5.1.p.1">This integrity scheme permits the detection of truncated messages.  However, it enables and even encourages processing of messages prior to receiving an complete message.  Actions taken on a partial message can produce incorrect results.  For example, a message could say &#8220;I need some 2mm copper cable, please send 100mm for evaluation purposes&#8221; then be truncated to &#8220;I need some 2mm copper cable, please send 100m&#8221;.  A network-based attacker might be able to force this sort of truncation by delaying packets that contain the remainder of the message.</p>
<p id="rfc.section.5.1.p.2">Whether it is safe to act on partial messages will depend on the nature of the message and the processing that is performed.</p>
<h2 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#algorithm-agility" id="algorithm-agility">Algorithm Agility</a>
</h2>
<p id="rfc.section.5.2.p.1">A new content encoding type is needed in order to define the use of a hash function other than SHA-256.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<h2 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#the-mi-sha256-http-content-encoding" id="the-mi-sha256-http-content-encoding">The &#8220;mi-sha256&#8221; HTTP Content Encoding</a>
</h2>
<p id="rfc.section.6.1.p.1">This memo registers the &#8220;mi-sha256&#8221; HTTP content-coding in the HTTP Content Codings Registry, as detailed in <a href="#encoding" class="xref">Section 2</a>.</p>
<p></p>

<ul>
<li>Name: mi-sha256</li>
<li>Description: A Merkle Hash Tree based content encoding that provides progressive integrity.</li>
<li>Reference: this specification</li>
</ul>
<h2 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#iana-header" id="iana-header">MI Header Field</a>
</h2>
<p id="rfc.section.6.2.p.1">This memo registers the &#8220;MI&#8221; HTTP header field in the Permanent Message Header Registry, as detailed in <a href="#header" class="xref">Section 3</a>.</p>
<p></p>

<ul>
<li>Field name: MI</li>
<li>Protocol: HTTP</li>
<li>Status: Standard</li>
<li>Reference: this specification</li>
<li>Notes:</li>
</ul>
<h2 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#mi-registry" id="mi-registry">The HTTP MI Parameter Registry</a>
</h2>
<p id="rfc.section.6.3.p.1">This memo establishes a registry for parameters used by the &#8220;MI&#8221; header field under the &#8220;Hypertext Transfer Protocol (HTTP) Parameters&#8221; grouping.  The &#8220;Hypertext Transfer Protocol (HTTP) MI Parameters&#8221; registry operates under an &#8220;Specification Required&#8221; policy <a href="#RFC5226" class="xref">[RFC5226]</a>.</p>
<p id="rfc.section.6.3.p.2">Entries in this registry are expected to include the following information:</p>
<p></p>

<ul>
<li>Parameter Name: The name of the parameter.</li>
<li>Purpose: A brief description of the purpose of the parameter.</li>
<li>Reference: A reference to a specification that defines the semantics of the parameter.</li>
</ul>
<p id="rfc.section.6.3.p.4">The initial contents of this registry are:</p>
<h3 id="rfc.section.6.3.1">
<a href="#rfc.section.6.3.1">6.3.1.</a> <a href="#mi-sha256-parameter" id="mi-sha256-parameter">mi-sha256 parameter</a>
</h3>
<p></p>

<ul>
<li>Parameter Name: mi-sha256</li>
<li>Purpose: The value of the integrity proof for the first record.</li>
<li>Reference: this document</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h2 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h2>
<table><tbody>
<tr>
<td class="reference"><b id="FIPS180-4">[FIPS180-4]</b></td>
<td class="top">
<a>Department of Commerce, National.</a>, "<a href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf">NIST FIPS 180-4, Secure Hash Standard</a>", March 2012.</td>
</tr>
<tr>
<td class="reference"><b id="MERKLE">[MERKLE]</b></td>
<td class="top">
<a>Merkle, R.</a>, "<a>A Digital Signature Based on a Conventional Encryption Function</a>", International Crytology Conference - CRYPTO , 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5226">[RFC5226]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="https://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", RFC 5226, DOI 10.17487/RFC5226, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7230">[RFC7230]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
</tbody></table>
<h2 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h2>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2818">[RFC2818]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, DOI 10.17487/RFC2818, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6962">[RFC6962]</b></td>
<td class="top">
<a>Laurie, B.</a>, <a>Langley, A.</a> and <a>E. Kasper</a>, "<a href="https://tools.ietf.org/html/rfc6962">Certificate Transparency</a>", RFC 6962, DOI 10.17487/RFC6962, June 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7233">[RFC7233]</b></td>
<td class="top">
<a>Fielding, R.</a>, <a>Lafon, Y.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7233">Hypertext Transfer Protocol (HTTP/1.1): Range Requests</a>", RFC 7233, DOI 10.17487/RFC7233, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="SRI">[SRI]</b></td>
<td class="top">
<a>Akhawe, D.</a>, <a>Braun, F.</a>, <a>Marier, F.</a> and <a>J. Weinberger</a>, "<a href="https://w3c.github.io/webappsec-subresource-integrity/">Subresource Integrity</a>", W3C CR , November 2015.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">David Benjamin and Erik Nygren both separately suggested that something like this might be valuable.  James Manger and Eric Rescorla provided useful feedback.</p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#faq" id="faq">FAQ</a>
</h1>
<p></p>

<ol>
<li>Why not include the first proof in the encoding?  <br><br> The requirements for the integrity proof for the first record require a great deal more flexibility than this allows for.  Transferring the proof separately is sometimes necessary.  Separating the value out allows for that to happen more easily.</li>
<li>Why do messages have to be processed in reverse to construct them?  <br><br> The final integrity value, no matter how it is derived, has to depend on every bit of the message.  That means that there are three choices: both sender and receiver have to process the whole message, the sender has to work backwards, or the receiver has to work backwards.  The current form is the best option of the three.  The expectation is that this will be useful for content that is generated once and sent multiple times, since the onerous backwards processing requirement can be amortized.</li>
<li>Why not just generate a table of hashes?  <br><br> An alternative design includes a header that comprises hashes of every block of the message.  The final proof is a hash of that table.  This has the advantage that the table can be built in any order.  The disadvantage is that a receiver needs to store the table while processing content, whereas a chained hash can be processed with a single stored hash worth of state no matter how many blocks are present.  The chained hash is also smaller by 32 octets.</li>
</ol>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></span>

  </address>
</div>

</body>
</html>
